# # version: 2
# # jobs:
# #   build:
# #      docker:
# #        -image: circleci/node:8-browsers

# #      working_directory: ~/Repo
# #      steps:
# #        - checkout
# #        - restore_cache:
# #           keys:
# #           - v1-dependencies-{{ checksum "package.json" }}
# #           # fallback to using the latest cache if no exact match is found
# #           - v1-dependencies-
# #        - run: yarn install
# #        - save_cache:
# #           paths:
# #             - node_modules
# #           key: v1-dependencies-{{ checksum "package.json" }}
# #        - run: yarn ng build --prod

# version: 2
# jobs:
#   build:
#     docker:
#       # specify the version you desire here
#       - image: circleci/node:8-browsers
      
#       # Specify service dependencies here if necessary
#       # CircleCI maintains a library of pre-built images
#       # documented at https://circleci.com/docs/2.0/circleci-images/
#       # - image: circleci/mongo:3.4.4

#     working_directory: ~/Repo

#     steps:
#       - checkout

#       # Download and cache dependencies
#       - restore_cache:
#           keys:
#           - v1-dependencies-{{ checksum "package.json" }}
#           # fallback to using the latest cache if no exact match is found
#           - v1-dependencies-

#       - run: yarn install

#       - save_cache:
#           paths:
#             - node_modules
#           key: v1-dependencies-{{ checksum "package.json" }}
        
#       # run tests!
#       - run: yarn ng build --prod

version: 2
jobs:
    # The build job
    build:
        working_directory: ~/project
        docker:
            - image: circleci/node:8-browsers
        steps:
            # Checkout the code from the branch into the working_directory
            - checkout
            # Log the current branch
            - run:
                name: Show current branch
                command: echo ${CIRCLE_BRANCH}
            # Restore local dependencies from cache
            - restore_cache:
                keys:
                - v1-dependencies-{{ checksum "package.json" }}
                - v1-dependencies-
            # Install project dependencies
            - run:
                name: Install local dependencies
                command: npm install
            # Cache local dependencies if they don't exist
            - save_cache:
                key: v1-dependencies-{{ checksum "package.json" }}
                paths:
                    - node_modules
            # Lint the source code
            # - run:
            #     name: Linting
            #     command: npm run lint
            # Test the source code
            # - run:
            #     name: Testing
            #     command: npm run test
            # Build project with different configuration based on
            # the current branch
            - run:
                name: Building
                command: |
                    # if [ "${CIRCLE_BRANCH}" == "staging" ]; then
                    #     npm run build-qa
                    # elif [ "${CIRCLE_BRANCH}" == "master" ]; then
                        npm run build
                    # else
                    #     npm run build-dev
                    # fi
            # Cache the dist folder for the deploy job
            - save_cache:
                key: v1-dist-{{ .Environment.CIRCLE_BRANCH }}-{{ .Environment.CIRCLE_SHA1 }}
                paths:
                    - dist


